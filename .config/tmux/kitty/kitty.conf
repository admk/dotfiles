source-file "$XDG_CONFIG_HOME/tmux/common.conf"

set-option -g default-shell ~/.local/bin/xh

# key bindings
set -g prefix M-a
set -g prefix2 None
bind-key -n M-r \
    source-file "$XDG_CONFIG_HOME/tmux/kitty/kitty.conf"\; \
    refresh-client -S\; \
    display-message "Reloaded kitty tmux configs and status"
bind-key -n M-q confirm-before kill-server
bind-key -n M-t run-shell "$XDG_CONFIG_HOME/tmux/kitty/bin/prewarm dispense"
bind-key -n M-w confirm-before kill-window
bind-key -n M-x copy-mode
bind-key -n M-S-j swap-window -t +1\; select-window -t +1
bind-key -n M-S-k swap-window -t -1\; select-window -t -1
bind-key -n M-j select-window -t :+
bind-key -n M-k select-window -t :-
bind-key -n M-1 select-window -t :1
bind-key -n M-2 select-window -t :2
bind-key -n M-3 select-window -t :3
bind-key -n M-4 select-window -t :4
bind-key -n M-5 select-window -t :5
bind-key -n M-6 select-window -t :6
bind-key -n M-7 select-window -t :7
bind-key -n M-8 select-window -t :8
bind-key -n M-9 select-window -t :9
bind-key -n M-, new-window "nvim ~/.config/kitty/kitty.conf"

# plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'noscript/tmux-mighty-scroll'
set -g @mighty-scroll-pass-through 'vim nvim tmux'
set -g @mighty-scroll-show-indicator 'on'

run "rg -Io 'set.*@(\\w+)\\s' -r '@$1' $XDG_CONFIG_HOME/tmux/plugins/tmux-catppuccin/**/*.conf | uniq | xargs -n1 -P0 tmux set -Ugq"
set -g @catppuccin_flavor "mocha"
set -g @catppuccin_window_status_style "rounded"
set -g @catppuccin_window_current_number_color "#{@thm_rosewater}"
set -g @catppuccin_window_flags "icon"
set -g @catppuccin_window_flags_icon_bell "Ë™"
set -g @catppuccin_window_flags_icon_last ""
set -g @catppuccin_window_flags_icon_current ""
set -g @plugin 'catppuccin/tmux#latest'

set-env -g TMUX_CONFIG "$XDG_CONFIG_HOME/tmux/kitty/kitty.conf"
set-env -g TMUX_PLUGIN_MANAGER_PATH "$XDG_CONFIG_HOME/tmux/plugins"

set -g bell-action any
set -g monitor-bell on
set -g status-position top
set -g status-justify absolute-centre
set -g status-left ""
set -g status-right ""
set -g renumber-windows on

set -g status on
# set -g status off
# set-hook -g after-new-window 'if "[ #{session_windows} -gt 1 ]" "set status on"'
# set-hook -g after-kill-pane 'if "[ #{session_windows} -lt 2 ]" "set status off"'
# set-hook -g after-refresh-client 'if "[ #{session_windows} -gt 1 ]" "set status on"'
# set-hook -g pane-exited 'if "[ #{session_windows} -lt 2 ]" "set status off"'
# set-hook -g window-layout-changed 'if "[ #{session_windows} -lt 2 ]" "set status off"'

# auto exit session when the client detaches
set-hook -g client-attached "set destroy-unattached on"

if "test ! -d $XDG_CONFIG_HOME/tmux/plugins/tpm" {
   run "git clone https://github.com/admk/tpm $XDG_CONFIG_HOME/tmux/plugins/tpm"
   run "$XDG_CONFIG_HOME/tmux/plugins/tpm/bin/install_plugins"
}
run $XDG_CONFIG_HOME/tmux/plugins/tpm/tpm
# vim: ft=tmux:
