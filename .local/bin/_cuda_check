#!/bin/bash

SLACK_TOKEN="$1"
KXH_HOST="$2"

out=$(nvidia-smi)
mkdir -p logs
if [[ $out == *"Failed to initialize NVML"* ]]; then
    slack chat send "$KXH_HOST: Failed to initialize NVML" '#servers-siat' >> logs/_cuda_check.log
    echo "[$(date)] $KXH_HOST: Failed to initialize NVML" >> logs/_cuda_check.log
else
    echo "[$(date)] $KXH_HOST: CUDA is working fine" >> logs/_cuda_check.log
fi
